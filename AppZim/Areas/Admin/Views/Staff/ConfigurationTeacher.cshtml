@using AppZim.Models
@using AppZim.TableSql
@using AppZim.ZIM
@using MB.Extensions

@{
    ViewBag.Title = "ConfigurationTeacher";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdminNew.cshtml";
    tbl_Account teacher = AccountTable.getbyID(Model.ID);
    var lops = ClassTable.getall().Where(x => x.isHide == false && x.Language == teacher.Language).ToList();
    string[] strText = new string[4] { "Trang đầu", "Trang cuối", "Trang sau", "Trang trước" };
    var lLanguage = Language.GetAll();

    var citys = LocationTable.getall();
    var dis = DistrictTable.getall();
    var teachers = AccountTable.getbyTeacherCourse();
    List<Admin_TeacherSalaryApproved_GetList_Result> salaryApproveds = ViewBag.ListSalaryApproved;
    var aclog = AccountTable.getbyID(Session["UID"].ToString().ToInt(0));
    if (aclog.RoleID == 4)
    {
        teachers = teachers.Where(x => x.ID == aclog.ID).ToList();
    }
}
<link href="~/app-assets/css/datepicker/datepicker.min.css" rel="stylesheet" />
<link href="~/app-assets/zimv2/assets/css/dashforge.profile.css" rel="stylesheet" />
<style>
    .list-student-course .table tr td {
        background: #fff !important;
    }

    .list-student-course .table th {
        background: #f3f4f7 !important;
    }

    td.class-name {
        width: 200px;
        min-width: 200px;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        background: #fff !important;
    }

    .select-td {
        min-width: 150px;
    }

    .teach {
        width: 60px;
        min-width: 60px;
        position: sticky;
        left: 200px;
        background: #fff;
    }


    .rating-box {
        display: flex;
        align-items: center;
    }

    .col-form-label {
        text-align: right;
    }

    .rating-total,
    .rating-detail,
    .rating-close {
        padding: 0px;
    }

    .rating-nav {
        list-style-type: none;
        padding: 0px;
    }

        .rating-nav li {
            display: flex;
            align-items: center;
        }

            .rating-nav li + li {
                margin-top: 10px;
            }

        .rating-nav .star {
            margin-right: 5px;
            font-size: 14px;
            color: #566376;
        }

        .rating-nav .process-bar {
            width: 130px;
            height: 10px;
            background-color: white;
            position: relative;
            margin-right: 20px;
            border-radius: 5px;
        }

            .rating-nav .process-bar .process-bar-inside {
                background-color: #ffa500;
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                border-radius: 5px;
            }

        .rating-nav .rating-link {
            text-decoration: none;
        }

    .rating-close-btn {
        border: 1px solid #e1e1e1;
        padding: 8px 20px;
        text-decoration: none;
        transition: .2s;
        display: inline-block;
        border-radius: 2px;
    }

        .rating-close-btn:hover {
            background-color: #01a301;
            color: #fff;
        }

    .student-rating {
        display: flex;
        align-items: center;
        /*padding: 30px;*/
    }

        .student-rating .rate {
            height: 46px;
            padding: 0 17px;
            float: left;
            margin-right: 20px;
        }

    .rate:not(:checked) > input {
        display: none;
    }

    .rate:not(:checked) > label {
        float: right;
        width: 1em;
        overflow: hidden;
        white-space: nowrap;
        cursor: pointer;
        font-size: 30px;
        color: #ccc;
    }

        .rate:not(:checked) > label:before {
            content: '★';
        }

    .rate > input:checked ~ label {
        color: #ffa500;
    }
    /*.rate:not(:checked)>label:hover,
        .rate:not(:checked)>label:hover~label {
            color: #ffa500;
        }*/
    .student-rating .title {
        /*margin-right: 20px;*/
        display: inline-block;
    }

    .student-rating .submit-rating {
        padding: 5px 10px;
        background-color: #01a301;
        position: relative;
        color: #fff;
        text-decoration: none;
        transition: .2s;
    }

        .student-rating .submit-rating::before {
            content: '';
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 10px solid transparent;
            border-right-color: #01a301;
            transition: .2s;
        }

    @@media only screen and (max-width : 768px) {
        .rating-total, .rating-detail, .rating-close {
            padding: 15px;
        }

        .rating-box {
            display: block;
            text-align: center;
        }

        .rating-detail {
            border-top: 1px solid #e1e1e1;
            border-bottom: 1px solid #e1e1e1;
            border-right: 0;
            border-left: 0;
        }

        .rating-nav li {
            justify-content: center;
        }

        .rating-nav .process-bar {
            width: 120px;
        }

        .student-rating {
            flex-wrap: wrap;
        }

            .student-rating .title {
                width: 100%;
            }

            .student-rating .rate {
                margin-right: 10px;
            }

        .student-rating {
            padding: 15px;
        }
    }

    #col-left-fixed:hover {
        background-color: #01a42f;
    }

    .table-striped tbody tr:nth-of-type(2n+2) {
        background-color: #f5f5f58a;
    }

    .table {
        border: 1px solid #c0ccda;
    }

        .table td {
            vertical-align: middle;
        }
</style>
<nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-style1 mg-b-30">
        <li class="breadcrumb-item"><a href="@Url.Action("TeacherList", "Staff", new { area = "Admin" })">Danh sách giáo viên</a></li>
        <li class="breadcrumb-item active" aria-current="page">Cập nhật thông tin</li>
    </ol>
</nav>
<div class="media d-block d-lg-flex">
    <!-- col -->
    <!--</div>--><!-- row -->
    <!--</div>--><!-- profile-sidebar -->
    <div class="config-teacher" style="width:100%">
        <div class="teacher-infomation mg-b-15">
            <fieldset class="form-fieldset">
                <legend>Thông tin tài khoản</legend>

                @using (Html.BeginForm("EditStaff", "Staff", FormMethod.Post, new { @enctype = "multipart/form-data" }))
                {
                    <input type="hidden" value="@teacher.ID" name="hdfID" />
                    <div class="form-group row">
                        <label for="user_name" class="col-sm-2 col-form-label">Tài khoản</label>
                        <div class="col-sm-4">
                            <input type="text" disabled class="form-control" id="user_name" placeholder="Full name" value="@Model.UserName">
                        </div>
                        <label class="col-sm-2 col-form-label">Trạng thái</label>
                        <div class="col-sm-4">
                            <select name="ddl-status" required class="form-control">
                                <option value="1">Chưa kích hoạt</option>
                                <option value="2">Hoạt động</option>
                                <option value="3">Khóa</option>
                            </select>
                            <script>
                                        $('select[name=ddl-status]').val(@teacher.Status);
                            </script>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="txt-full-name" class="col-sm-2 col-form-label">Họ và tên</label>
                        <div class="col-sm-4">
                            <input value="@Model.FullName" name="txt-full-name" type="text" class="validate form-control" required>
                        </div>
                        <label for="txt-email" class="col-sm-2 col-form-label">Email</label>
                        <div class="col-sm-4">
                            <input type="email" class="form-control" id="txt-email" name="txt-email" placeholder="Email address" value="@Model.Email">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="txt-phone" class="col-sm-2 col-form-label">Số điện thoại</label>
                        <div class="col-sm-4">
                            <input type="number" class="form-control" id="txt-phone" name="txt-phone" placeholder="Phone number" value="@Model.Phone">
                        </div>
                        <label for="txt-birthday" class="col-sm-2 col-form-label">Ngày sinh</label>
                        <div class="col-sm-4">
                            <input type="text" id="txt-birthday" name="txt-birthday" class="form-control datetimepicker date-only" placeholder="dd/mm/yyyy" required
                                   value="@Model.Birthday.ToString("dd/MM/yyyy")">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="txt-zoomid" class="col-sm-2 col-form-label">ZoomID</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="txt-zoomid" name="txt-zoomid" value="@teacher.ZoomID">
                        </div>
                        <label for="txt-zoompass" class="col-sm-2 col-form-label">Zoom Password</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="txt-zoompass" name="txt-zoompass" value="@teacher.ZoomPassword">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="txt-bank" class="col-sm-2 col-form-label">Thông tin ngân hàng</label>
                        <div class="col-sm-4">
                            <textarea type="text" class="form-control" id="txt-bank" name="txt-bank" rows="1">@teacher.BankInformation</textarea>
                        </div>

                        <label for="txt-fb" class="col-sm-2 col-form-label">Link FB</label>
                        <div class="col-sm-4">
                            <textarea type="text" class="form-control" id="txt-fb" name="txt-fb" rows="1">@teacher.LinkFB</textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="txt-address" class="col-sm-2 col-form-label">Địa chỉ</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" row="1" id="txt-address" name="txt-address"
                                   value="@teacher.Address" />
                        </div>
                        <label for="txt-address" class="col-sm-2 col-form-label">Ngôn ngữ dạy</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="dll-language" name="dll-language">
                                <option value="0"></option>
                                @foreach (var item in lLanguage)
                                {
                                    <option value="@item.ID" @(item.ID == teacher.Language ? "selected" : "")>@item.Name</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-form-label col-sm-2 col-form-label">Giới tính</label>
                        <div class="col-sm-4 d-flex align-items-center">

                            @{ int gen = teacher.GenderID.Value;
                                if (gen == 1)
                                {
                                    <div class="custom-control custom-radio">
                                        <input type="radio" name="sex" class="custom-control-input" id="sex-male" value="1" checked>
                                        <label class="custom-control-label" for="sex-male">Nam</label>
                                    </div>
                                }
                                else
                                {
                                    <div class="custom-control custom-radio">
                                        <input type="radio" name="sex" class="custom-control-input" id="sex-male" value="1">
                                        <label class="custom-control-label" for="sex-male">Nam</label>
                                    </div>
                                }
                                if (gen == 2)
                                {
                                    <div class="mg-l-20 custom-control custom-radio">
                                        <input type="radio" name="sex" class="custom-control-input" id="sex-female" value="2" checked>
                                        <label class="custom-control-label" for="sex-female">Nữ</label>
                                    </div>
                                }
                                else
                                {
                                    <div class="mg-l-20 custom-control custom-radio">
                                        <input type="radio" name="sex" class="custom-control-input" id="sex-female" value="2">
                                        <label class="custom-control-label" for="sex-female">Nữ</label>
                                    </div>
                                }
                                if (gen == 3)
                                {
                                    <div class="mg-l-20 custom-control custom-radio">
                                        <input type="radio" name="sex" class="custom-control-input" id="sex-free" value="3" checked>
                                        <label class="custom-control-label" for="sex-free">Không xác định</label>
                                    </div>
                                }
                                else
                                {
                                    <div class="mg-l-20 custom-control custom-radio">
                                        <input type="radio" name="sex" class="custom-control-input" id="sex-free" value="3">
                                        <label class="custom-control-label" for="sex-free">Không xác định</label>
                                    </div>
                                }
                            }
                        </div>
                        <label for="certificate" class="col-form-label col-sm-2 pt-0">&nbsp;</label>
                        <div class="col-sm-2">
                            <a href="@teacher.LinkCertificate" class="btn btn-success" download>Chứng chỉ</a>
                        </div>
                        <div class="col-sm-2">
                            <a href="@teacher.LinkCV" class="btn btn-success" download>CV</a>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-form-label col-sm-2 pt-0">Chứng chỉ</label>
                        <div class="col-sm-4">
                            <input type="file" id="certificate" name="certificate">
                        </div>
                        <label class="col-form-label col-sm-2 pt-0">CV</label>
                        <div class="col-sm-4">
                            <input type="file" id="cv" name="cv">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="txt-dw" class="col-form-label col-sm-2 pt-0">Ngày nhận việc</label>
                        <div class="col-sm-4">
                            <input type="text" id="txt-dw" name="txt-dw" class="form-control datetimepicker date-only" value="@(teacher.DateStartWork == null ? "" : teacher.DateStartWork.Value.ToString("dd/MM/yyyy"))">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-form-label col-sm-2 pt-0">Mật khẩu</label>
                        <div class="col-sm-4">
                            <input type="password" id="txt-password" name="txt-password" class="form-control" placeholder="******" autocomplete="new-password" />
                        </div>
                        <label class="col-form-label col-sm-2 pt-0">Nhập lại mật khẩu mới</label>
                        <div class="col-sm-4">
                            <input type="password" class="form-control" id="txt-password-confirm" name="txt-password-confirm" placeholder="******" autocomplete="new-password" />
                        </div>
                    </div>
                    <div class="text-right">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#div-config"><i data-feather="video"></i> Cấu hình Zoom</button>
                        <button type="submit" class="btn btn-success mg-l-10"><i data-feather="check"></i> Cập nhật</button>
                    </div>
                }
            </fieldset>
        </div>


        <div class="modal" id="div-config" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered wd-sm-500" role="document">
                <div class="modal-content">
                    @using (Html.BeginForm("AddUpdateConfig", "ZoomMeeting", FormMethod.Post))
                    {
                        tbl_ZoomTeacherAPI c = ZoomTeacherAPITable.GetbyTeacherID(teacher.ID);
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="hdfID" value="@(c==null?0:c.ID)" />
                        <input type="hidden" name="txt-uid" value="@teacher.ID" />
                        <input type="hidden" name="txt-page" value="1" /> //1. trả về trang chi tiết, ngược lại là trang danh sách chung
                        <div class="modal-body pd-20 pd-sm-40">
                            <a href="" role="button" class="close pos-absolute t-15 r-15" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></a>
                            <div>
                                <h4>Cấu hình</h4>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label for="txt-userID">Tài khoản:</label>
                                            <input id="txt-userID" name="txt-userID" required type="email" value="@(c==null?"":c.UserID)" onkeypress="return event.charCode != 32" class="form-control" placeholder="taikhoanzoom@gmail.com" />
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label for="txt-key">API Key:</label>
                                            <input id="txt-key" name="txt-key" required type="text" value="@(c==null?"":c.APIKey)" onkeypress="return event.charCode != 32" class="form-control" placeholder="..." />
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label for="txt-secrect">API Secrect:</label>
                                            <input id="txt-secrect" name="txt-secrect" required type="text" value="@(c==null?"":c.APISecrect)" onkeypress="return event.charCode != 32" class="form-control" placeholder="..." />
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label for="txt-token">Mã xác thực:</label>
                                            <textarea id="txt-token" name="txt-token" type="text" class="form-control" placeholder="..." onkeypress="return event.charCode != 32" rows="3">@(c==null?"":c.Token)</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <a href="/Admin/ZoomMeeting/RegistrationZoom" target="_blank" class="text-info"><i class="fas fa-info-circle"></i> Hướng dẫn</a>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block mg-t-10">Xác nhận</button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="mg-b-15">
            <button class="btn btn-primary" onclick="CheckAll()">Chọn hết</button>
        </div>
        <div class="list-student-course">
            @{
                foreach (var item in lops)
                {
                    //var subs = SubjectTable.getbyclassid(item.ID);
                    //subs = subs.Where(n => n.isHide != true && n.SpecialSubject != true).ToList();
                    var checkclass = AssignTeacherClassTable.checkclass(Model.ID, item.ID);

                    <div class="table-responsive mg-b-15">
                        <table id="col-left-fixed" class="table table-bordered centered table-vcenter">
                            <thead>
                                <tr>
                                    <th class="sticky-col">Tên lớp học</th>
                                    <th class="teach">Dạy</th>
                                    @*@{
                                        foreach (var j in subs)
                                        {
                                            <th>@j.SubjectName</th>
                                        }
                                    }*@
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="class-name sticky-col">
                                        <span>@item.ClassName</span>
                                    </td>
                                    <td class="teach">
                                        <p style="margin-bottom: 0px">
                                            <label class='lb-contrainer'>
                                                @{
                                                    if (checkclass)
                                                    {
                                                        <input checked onchange="updateclass(@item.ID)" type="checkbox">
                                                    }
                                                    else
                                                    {
                                                        <input onchange="updateclass(@item.ID)" type="checkbox">
                                                    }
                                                }
                                                <span class='checkmark'></span>
                                            </label>
                                        </p>
                                    </td>
                                    @*@{
                                        foreach (var j in subs)
                                        {
                                            var ck = AssignTeacherClassTable.getbyuidclasssub(Model.ID, item.ID, j.ID);
                                            <td class="select-td">
                                                <div>
                                                    <select id="ddl-lv-@j.ID" class="custom-select">
                                                        <option value="0">---</option>
                                                        <option value="1">Trung bình</option>
                                                        <option value="2">Khá</option>
                                                        <option value="3">Giỏi</option>
                                                    </select>
                                                    @if (ck != null)
                                                    {
                                                        <script>
                                                                $('#ddl-lv-@j.ID').val(@ck.SubjectLevel);
                                                        </script>
                                                    }
                                                    <script>
                                                            $("#ddl-lv-@j.ID").on('change', function () {
                                                                var lv = $(this).val();
                                                                updatesubject(@item.ID, @j.ID, lv);
                                                            });
                                                    </script>
                                                </div>
                                            </td>
                                        }
                                    }*@
                                </tr>
                            </tbody>
                        </table>
                    </div>
                }
            }
        </div>
        <div class="d-xl-flex align-items-center justify-content-between ">
            <div class="row">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb breadcrumb-style1 mg-b-30">
                            <li class="breadcrumb-item active" aria-current="page">Lịch sử lương</li>
                        </ol>
                    </nav>
                </div>
            </div>
            <div class="d-xl-block">
                <div class="d-flex justify-content-xl-center mg-t-20 mg-xl-t-0 flex-wrap">
                    <div class="form-group mg-l-5">
                        <input name="slYear" id="slYear" type="number" onchange="ReloadTableSalary()" class="form-control" placeholder="--Năm--" />
                    </div>
                    <div class="form-group mg-l-5">
                        <select name="slMonth" class="custom-select" id="slMonth" onchange="ReloadTableSalary()">
                            <option value="0">-- Tháng --</option>
                            @{
                                for (int i = 1; i <= 12; i++)
                                {
                                    <option value="@i">@i</option>
                                }
                            }
                        </select>
                        <script>
                        $('select[name=slMonth]').val(@ViewBag.Month)
                        </script>
                    </div>
                </div>
            </div>
        </div>
        <div class="customer-table mg-t-30">
            <div class="table-responsive">
                <table class="table table-striped table-vcenter" id="dataTables">
                    <thead class="thead-light">
                        <tr>
                            <th>Năm</th>
                            <th>Tháng</th>
                            <th><span>Lương học thử</span></th>
                            <th><span>Thưởng thêm</span></th>
                            <th><span>Trạng thái duyệt lương</span></th>
                            <th><span>Tổng lương</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            foreach (var i in salaryApproveds)
                            {
                                <tr>
                                    <td>@i.Year</td>
                                    <td>@i.Month</td>
                                    <td><button class="btn btn-secondary" onclick="LoadTrialList(@i.TeacherID)" data-toggle="modal" data-target="#trial-salary-list">@String.Format("{0:0,0}", i.TrialStudySalary) VNĐ</button></td>
                                    <td>@String.Format("{0:0,0}", i.Bonus) VNĐ</td>
                                    <td class="text-success">
                                        @if (i.isDonePaid == true)
                                        {
                                            <i style="color:#01a42f;font-size:25px" class="far fa-check-circle"></i>
                                        }
                                        else
                                        {
                                            <i style="color:#db0606;font-size:25px" class="far fa-times-circle"></i>
                                        }
                                    </td>
                                    <td class="text-success tx-bold">@String.Format("{0:0,0}", i.TotalSalary) VNĐ</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <nav aria-label="Page navigation">
            <ul class="pagination mg-b-0 justify-content-end mg-t-10">
                <div class="pagination-container">
                    @PhanTrang.PhanTrangCustom(10, ViewBag.Page, ViewBag.PageCount, Request.RawUrl, strText)
                </div>
            </ul>
        </nav>
        <div class="d-xl-flex align-items-center justify-content-between ">

            <div class="d-xl-block">
                <div class="d-flex justify-content-xl-center mg-t-20 mg-xl-t-0 flex-wrap">
                    <div class="form-group mg-l-5">
                        <input name="slYearStatistics" id="slYearStatistics" type="number" onchange="chartSalary()" class="form-control" placeholder="--Năm--" />
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body pos-relative pd-0">
            <canvas id="myChartStatisticsSalary" style="width:100%;max-width:auto"></canvas>
        </div>
        
    </div>
</div>
<div class="modal" id="trial-salary-list" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered wd-sm-700" role="document">
        <div class="modal-content">
            <div class="modal-body pd-20 pd-sm-40">
                <a href="" role="button" class="close pos-absolute t-15 r-15" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </a>
                <div>
                    <h4>Danh sách các buổi học thử</h4>
                    <div class="form-group" id="div-trial-list"></div>
                </div>
            </div>
        </div>
    </div>
</div><!-- media -->

@section myScripts{
    <script src="~/app-assets/js/datepicker/bootstrap-datepicker.min.js"></script>
    @*dành cho biểu đồ*@
    <script src="~/app-assets/zimv2/lib/jquery.flot/jquery.flot.js"></script>
    <script src="~/app-assets/zimv2/lib/jquery.flot/jquery.flot.stack.js"></script>
    <script src="~/app-assets/zimv2/lib/jquery.flot/jquery.flot.resize.js"></script>
    <script src="~/app-assets/zimv2/lib/chart.js/Chart.bundle.min.js"></script>
    <script src="~/app-assets/zimv2/lib/peity/jquery.peity.min.js"></script>
    <script src="~/app-assets/zimv2/lib/jqvmap/jquery.vmap.min.js"></script>
    <script src="~/app-assets/zimv2/lib/jqvmap/maps/jquery.vmap.usa.js"></script>
    <script src="~/app-assets/zimv2/assets/js/dashforge.sampledata.js"></script>

    <script>
        var grapharea = document.getElementById("myChartStatisticsSalary").getContext("2d");
        var labelsMonth = [];
        var dataSalary = [];
        var myChart;
    $(document).ready(function () {
        $('.edit-profile').on('click', function () {
            $('.cs-account').slideToggle();
            $('.cs-profile').slideToggle();
        });
        $('.change-password').on('click', function () {
            $('.cs-account').slideDown();
            $('.cs-profile').slideUp();
        });
        $("#slYear").datepicker({
            format: "yyyy",
            startView: "years",
            minViewMode: "years"
        });
        $("#slYearStatistics").datepicker({
            format: "yyyy",
            startView: "years",
            minViewMode: "years"
        });
        myChart = new Chart(grapharea, {
            type: 'bar',
            data: {
                labels: labelsMonth,
                datasets: [{
                    label: 'Thống kê lương',
                    data: dataSalary,
                    backgroundColor: ["red", "blue", "yellow", "green", "pink", "brown", "orange", "PapayaWhip", "mint", "purple", "LightCoral", "Olive"],
                    borderColor: ["red", "blue", "yellow", "green", "pink", "brown", "orange", "PapayaWhip", "mint", "purple", "LightCoral", "Olive"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            },
        });
        chartSalary();
    });


    function updateclass(classid) {
        $.ajax({
            type: "POST",
            url: "/Admin/Staff/AssignClass",
            data: '{UID: ' + @Model.ID + ', ClassID:' + classid +'}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                if (msg.status === false) {
                    toast.create({
                    title: 'Thông báo!',
                    text: 'Có lỗi, vui lòng thử lại',
                    icon: 'notifications_active',
                    classBackground: 'noti-error',
                    timeout: 2500
                    })
                }
            },
            error: function (xmlhttprequest, textstatus, errorthrow) {
                console.log('e: AssignClass')
            }
        });
    }

    function updatesubject(classid, subjectid, lv) {
        $.ajax({
            type: "POST",
            url: "/Admin/Staff/AssignSubject",
            data: '{UID: ' + @Model.ID + ', ClassID:' + classid + ', SubjectID:' + subjectid + ', LevelID:' + lv + '}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                if (msg.status === false) {
                    toast.create({
                        title: '<span>Thông báo!</span>',
                        text: 'Có lỗi, vui lòng thử lại',
                        icon: 'notifications_active',
                        classBackground: 'noti-error',
                        timeout: 4000
                    })
                }
            },
            error: function (xmlhttprequest, textstatus, errorthrow) {
                console.log('e: AssignSubject')
            }
        });
     }
    function CheckAll() {
        $.ajax({
            type: "POST",
            url: "/Admin/Staff/AssignAllClass",
            data: '{UID: ' + @Model.ID + '}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                if (msg.rs == true) {
                    toast.create({
                        title: 'Thông báo!',
                        text: 'Thành công',
                        icon: 'notifications_active',
                        classBackground: 'noti-success',
                        timeout: 2500
                    });
                    window.location.reload();
                }
            },
                error: function (xmlhttprequest, textstatus, errorthrow) {
                    console.log('e: AssignClass')
                }
            });
        }



        //Function for Salary
        function ReloadTableSalary(){
            var month = $('select[name=slMonth]').val();
            var year = $('#slYear').val();
            if (year == '')
                year = 0;
            var table = $('#dataTables tbody');
            $.ajax({
                type: "POST",
                url: '/Admin/Staff/GetListSalaryApproved',
                data: '{teacherId: ' + @teacher.ID + ', month:' + month + ', year:' + year + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    //drawing your datatable here....
                    table.empty();
                    const result = data['data'];
                    var html = '';
                    for (let i = 0; i < result.length; i++) {
                        const config = { style: 'currency', currency: 'VND', maximumFractionDigits: 9 }
                        const trialStudySalaryFormated = new Intl.NumberFormat('vi-VN', config).format(result[i].TrialStudySalary);
                        const bonusFormated = new Intl.NumberFormat('vi-VN', config).format(result[i].Bonus);
                        const totalSalaryFormated = new Intl.NumberFormat('vi-VN', config).format(result[i].TotalSalary);
                        html += '<tr><td>' + result[i].Year + '</td>';
                        html += '<td>' + result[i].Month + '</td>';
                        html += '<td><button class="btn btn-secondary" onclick="LoadTrialList(' + result[i].TeacherID + ')" data-toggle="modal" data-target="#trial-salary-list">' + trialStudySalaryFormated + 'VNĐ</button></td>';
                        html += '<td>' + bonusFormated + '</td>';
                        if (result[i].isDonePaid == true)
                            html += '<td class="text-success"><i style="color:#01a42f;font-size:25px" class="far fa-check-circle"></i></td>'
                        else
                            html += '<td class="text-success"><i style="color:#db0606;font-size:25px" class="far fa-times-circle"></i></td>'
                        html += '<td class="text-success tx-bold">' + totalSalaryFormated + '</td>';
                        html += '</tr>';
                    }
                    table.html(html);
                }
            });
        }
        function chartSalary() {
            var year = $('#slYearStatistics').val();
            if (year == '')
                year = 0;
            console.log(@teacher.ID);
            $.ajax({
                type: "POST",
                url: '/Admin/Staff/GetStatisticsSalary',
                data: '{teacherId: ' + @teacher.ID + ', year:' + year + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data)
                {
                    if (data.rs == true) {
                       
                        dataSalary = data.totalSalary;
                        labelsMonth = data.monthLabel;
                        myChart.destroy();
                        myChart = new Chart(grapharea, {
                            type: 'bar',
                            data: {
                                labels: labelsMonth,
                                datasets: [{
                                    label: 'Tổng lương',
                                    data: dataSalary,
                                    backgroundColor: ["red", "blue", "yellow", "green", "pink", "brown", "orange", "PapayaWhip", "mint", "purple", "LightCoral", "Olive"],
                                    borderColor: ["red", "blue", "yellow", "green", "pink", "brown", "orange", "PapayaWhip", "mint", "purple", "LightCoral", "Olive"],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    },
                                    xAxes: [{
                                        barPercentage: 0.2
                                    }]
                                }
                            },
                        });
                    }

                }
            });
        }

        function LoadTrialList(teacherId) {
            let month = $('select[name=slMonth]').val();
            let year = $('input[name=slYear]').val();

            $.ajax({
                url: '/SalaryStaff/LoadTrialList',
                method: 'post',
                dataType: 'json',
                data: { teacherId: teacherId, month: month, year: year },
                success: function (r) {
                    if (r.rs == true) {
                        let stringHtml = '';
                        for (let i = 0; i < r.data.length; i++) {
                            stringHtml += `<div class="mg-b-5">${i + 1}. <b>Ngày</b>: ${r.data[i].DateTest}  - <b>Giờ</b>: ${r.data[i].TimeTest}  - <b>Học viên</b>: ${r.data[i].StudentName}</div>`;
                        }

                        $('#div-trial-list').html(stringHtml);
                    }
                }
            });
        }


    </script>
}